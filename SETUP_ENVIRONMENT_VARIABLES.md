# üîß Environment Variables Setup Guide

This guide will help you set up all the required environment variables for your Freshed Grocery application.

## üìã Required Environment Variables

### Backend Service (`freshed-grocery-backend`)

#### Database Configuration
```bash
# Your MongoDB connection string
DATABASE_URL=mongodb+srv://freshed_user:uNuFPlQVQNWF76tB@freshed-grocery-cluster.lzqoako.mongodb.net/freshed_grocery?retryWrites=true&w=majority&appName=freshed-grocery-cluster
```

#### JWT Secrets (Run `npm run generate:secrets` to generate these)
```bash
# Generate secure secrets for JWT tokens
JWT_SECRET= # Generated by script
JWT_REFRESH_SECRET= # Generated by script
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d
```

#### Email Configuration (For OTP and notifications)
```bash
# SMTP settings for sending emails
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
FROM_EMAIL=Freshed Grocery <noreply@freshed.co.tz>
```

#### Server Configuration
```bash
# Server settings
PORT=10000
NODE_ENV=production
```

#### CORS Configuration
```bash
# Allow requests from frontend
CORS_ORIGIN=https://freshed-grocery-frontend.onrender.com
```

#### Rate Limiting
```bash
# Prevent abuse
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

#### OTP Configuration
```bash
# One-time password settings
OTP_EXPIRES_IN_MINUTES=5
OTP_LENGTH=6
```

#### Admin Configuration
```bash
# Default admin user
DEFAULT_ADMIN_EMAIL=admin@freshed.co.tz
DEFAULT_ADMIN_NAME=Freshed Admin
DEFAULT_ADMIN_PASSWORD= # Set a strong password
```

### Frontend Service (`freshed-grocery-frontend`)

#### Application Configuration
```bash
# Frontend settings
VITE_APP_URL=https://freshed-grocery-frontend.onrender.com
VITE_APP_NAME=Freshed Grocery Tanzania
```

#### ClickPesa Payment Gateway Configuration
```bash
# Your actual ClickPesa credentials
VITE_CLICKPESA_API_KEY= # Your actual API key
VITE_CLICKPESA_MERCHANT_ID= # Your merchant ID
VITE_CLICKPESA_PAY_BILL_NUMBER= # Your pay bill number
VITE_CLICKPESA_BASE_URL=https://api.clickpesa.com
VITE_CLICKPESA_WEBHOOK_SECRET= # Generated by script
VITE_CLICKPESA_DEMO_MODE=false
```

#### Admin Access Configuration
```bash
# Admin credentials (same as backend)
VITE_ADMIN_EMAIL=admin@freshed.co.tz
VITE_ADMIN_PASSWORD= # Same as backend admin password
```

## üöÄ Setup Instructions

### 1. Generate JWT Secrets
```bash
# Navigate to backend directory
cd backend

# Generate secure secrets
npm run generate:secrets
```

Copy the generated secrets to your `.env` files.

### 2. Test Database Connection
```bash
# Navigate to backend directory
cd backend

# Test your MongoDB connection
npm run test:db
```

### 3. Configure Email Settings
If using Gmail:
1. Enable 2-factor authentication on your Google account
2. Generate an App Password:
   - Go to Google Account settings
   - Security ‚Üí 2-Step Verification ‚Üí App passwords
   - Generate a new app password for "Mail"
   - Use this as your `SMTP_PASS`

### 4. Set Admin Password
Create a strong admin password with:
- At least 12 characters
- Mix of uppercase, lowercase, numbers, and symbols
- Something you can remember but others can't guess

## üîê Security Best Practices

### 1. Secret Management
- Never commit `.env` files to version control
- Use different secrets for development, staging, and production
- Rotate secrets periodically
- Store secrets in a secure password manager

### 2. Database Security
- Ensure your MongoDB Atlas IP whitelist includes Render's IP ranges
- Use strong database user passwords
- Limit database user permissions to only what's needed

### 3. Email Security
- Use App Passwords instead of regular passwords
- Don't use your personal email for production
- Consider using a transactional email service like SendGrid

## üß™ Testing Your Configuration

### 1. Local Testing
```bash
# Test database connection
cd backend
npm run test:db

# Build the application
cd ..
npm run build
```

### 2. Environment Variable Validation
Before deploying, verify all required variables are set:
- Check that no variables are missing
- Ensure sensitive values are not exposed in logs
- Test connectivity to external services

## üìû Troubleshooting

### Database Connection Issues
1. Verify your MongoDB Atlas IP whitelist includes your current IP
2. Check that your username and password are correct
3. Ensure your MongoDB cluster is running
4. Confirm your connection string format is correct

### Email Sending Issues
1. Verify SMTP credentials are correct
2. Check that App Passwords are being used (for Gmail)
3. Ensure your email provider allows SMTP access
4. Test with a simple email sending script

### ClickPesa Payment Issues
1. Verify API credentials are correct
2. Check that your account is activated
3. Ensure `VITE_CLICKPESA_DEMO_MODE` is set to `false` for production
4. Test with a small transaction first

## üìù Final Checklist

Before deploying to Render:

- [ ] All environment variables are set
- [ ] Database connection tested and working
- [ ] Email configuration tested and working
- [ ] ClickPesa credentials verified
- [ ] JWT secrets generated and secure
- [ ] Admin credentials set and secure
- [ ] CORS configuration correct
- [ ] No sensitive data in version control

---
**Remember**: These are sensitive credentials. Keep them secure and never share them publicly.